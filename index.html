<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Anonymous Valentine Note</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 500px;
        width: 100%;
      }

      h2 {
        color: #667eea;
        text-align: center;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      label {
        display: block;
        color: #333;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 14px;
      }

      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        transition: border-color 0.3s;
        margin-bottom: 20px;
      }

      select:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      textarea {
        resize: vertical;
        min-height: 120px;
      }

      button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      .hearts {
        text-align: center;
        font-size: 24px;
        margin: 20px 0;
        animation: heartbeat 1.5s infinite;
      }

      @keyframes heartbeat {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .info-box {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #667eea;
      }

      .info-box p {
        color: #666;
        font-size: 13px;
        line-height: 1.6;
        margin: 0;
      }

      .loading {
        display: none;
        text-align: center;
        margin-top: 20px;
      }

      .loading.active {
        display: block;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>üíå Send an Anonymous Valentine Note</h2>
      <p class="subtitle">Spread love anonymously this Valentine's Day!</p>

      <div class="info-box">
        <p>
          ‚ÑπÔ∏è Please keep your message kind, respectful, and appropriate. Let‚Äôs
          make this a positive experience for everyone. ‚ù§Ô∏è
        </p>
      </div>

      <form
        id="valentineForm"
        method="POST"
        action="https://richie.uniservhub.com/webhook/valentine-notes"
      >
        <label for="recipient">Who is this note for? üíù</label>
        <select name="recipient" id="recipient" required>
          <option value="">-- Select a colleague --</option>
          <option value="u01">Abel Mabruke</option>
          <option value="u02">Agnes Mawioo</option>
          <option value="u03">Albert Mbugua</option>
          <option value="u04">Alice Kerubo</option>
          <option value="u05">Ann Nyambura</option>
          <option value="u06">Anne Wambugu</option>
          <option value="u07">Audrey Cherotich</option>
          <option value="u08">Benjamin Sore</option>
          <option value="u09">Brian Chege</option>
          <option value="u10">Catherine Katana</option>
          <option value="u11">Catherine Kimani</option>
          <option value="u12">Celestine Mukopi</option>
          <option value="u13">Charity Wanjiku</option>
          <option value="u14">Charles Mwaura</option>
          <option value="u15">Christine Ouma</option>
          <option value="u16">Claire Bosibori</option>
          <option value="u17">Claire Maloba</option>
          <option value="u18">Dennis Musyoki</option>
          <option value="u19">Dennis Omondi</option>
          <option value="u20">Dennis Toromo</option>
          <option value="u21">Depporah Ochieng</option>
          <option value="u22">Diana Matheri</option>
          <option value="u23">Diana Rose</option>
          <option value="u24">Dorcas Atuo</option>
          <option value="u25">Edith Amwayi</option>
          <option value="u26">Elizabeth Maina</option>
          <option value="u27">Elizabeth Mutuku</option>
          <option value="u28">Emmanuel Muga</option>
          <option value="u29">Esther Mackenzie</option>
          <option value="u30">Faith Mambo</option>
          <option value="u31">Felix Ousa</option>
          <option value="u32">Grace Gitau</option>
          <option value="u33">Hazel Bonare</option>
          <option value="u34">Imelda Musuanii</option>
          <option value="u35">Irene Mwende</option>
          <option value="u36">Ivvone Kemunto</option>
          <option value="u37">Jordan Koech</option>
          <option value="u38">Joy Kimani</option>
          <option value="u39">Karl Caleb</option>
          <option value="u40">Khaled Faiz</option>
          <option value="u41">Krutika Alby</option>
          <option value="u42">Lavender Tsindoli</option>
          <option value="u43">Lilian Amwayi</option>
          <option value="u44">Lina Atieno</option>
          <option value="u45">Lydia Mwaura</option>
          <option value="u46">Lynn Mikal</option>
          <option value="u47">Maggy Gatitu</option>
          <option value="u48">Marby Mwangi</option>
          <option value="u49">Margaret Kiyo</option>
          <option value="u50">Mary Maina</option>
          <option value="u51">Mary Njeri</option>
          <option value="u52">Mercy Kavata</option>
          <option value="u53">Mercy Mueni</option>
          <option value="u54">Mornica Mwende</option>
          <option value="u55">Moureen Apondi</option>
          <option value="u56">Nelly Thuita</option>
          <option value="u57">Nelsha Hasham</option>
          <option value="u58">Newton Mugambi</option>
          <option value="u59">Nicole Ingutia</option>
          <option value="u60">Nicole Mureithi</option>
          <option value="u61">Noel Manthi</option>
          <option value="u62">Pauline Wambui</option>
          <option value="u63">Peninah Laxmi</option>
          <option value="u64">Philip Mutisya</option>
          <option value="u65">Purity Kioko</option>
          <option value="u66">Rachel Otete</option>
          <option value="u67">Reena Wambui</option>
          <option value="u68">Richie Munyiri</option>
          <option value="u69">Rosebella Nanjala</option>
          <option value="u70">Ruth Korir</option>
          <option value="u71">Samiya Khan</option>
          <option value="u72">Sarah Mwashigadi</option>
          <option value="u73">Sharlet Rono</option>
          <option value="u74">Sharon Udoh</option>
          <option value="u75">Silvia Ndunge</option>
          <option value="u76">Sophia Ochieng</option>
          <option value="u77">Susan Kamau</option>
          <option value="u78">Susan Mwangi</option>
          <option value="u79">Susper Reginald</option>
          <option value="u80">Tamara Makacha</option>
          <option value="u81">Terry Karimi</option>
          <option value="u82">Victor Enzobeli</option>
          <option value="u83">Wade</option>
          <option value="u84">Wambui Gathogo</option>
          <option value="u85">Wendy Nkunja</option>
          <option value="u86">Wilfred Kamau</option>
          <option value="u87">Yvonne Otieno</option>
          <option value="u88">Zipporah Muthee</option>
          <option value="u89">Abigael Nyambura</option>
          <option value="u90">Philip Ombima</option>
          <option value="u91">Kelvin Ngeno</option>
          <option value="u92">Asa</option>
          <option value="u93">Mercy Wangui</option>
          <option value="u94">Hope</option>
          <option value="u95">Monica Wangari</option>
        </select>

        <label for="message">Your message ‚úçÔ∏è</label>
        <textarea
          name="message"
          id="message"
          rows="6"
          required
          placeholder="Write something nice... (e.g., 'Your positive energy brightens everyone's day!')"
          maxlength="500"
        ></textarea>

        <div
          style="
            text-align: right;
            margin-bottom: 15px;
            color: #999;
            font-size: 12px;
          "
        >
          <span id="charCount">0</span>/500 characters
        </div>

        <button type="submit">Send üíñ</button>
      </form>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p style="margin-top: 10px; color: #667eea">Sending your message...</p>
      </div>

      <div class="hearts">üíï üíñ üíó üíì üíù</div>
    </div>

    <script>
      // Character counter
      const AUTH_TOKEN =
        "87afdf5e-5626-4160-95c8-64b7bb30201abe9ba5b7-e600-40be-8146-a73e5df372b7";
      const messageField = document.getElementById("message");
      const charCount = document.getElementById("charCount");

      messageField.addEventListener("input", function () {
        charCount.textContent = this.value.length;
      });

      // Rate limiting config
      const RATE_LIMIT_MAX = 3; // max sends
      const RATE_LIMIT_WINDOW = 60 * 60 * 1000; // 1 hour in ms

      function getRateLimitData() {
        const data = localStorage.getItem("vday_sends");
        if (!data) return { count: 0, windowStart: Date.now() };
        return JSON.parse(data);
      }

      function isRateLimited() {
        const { count, windowStart } = getRateLimitData();
        const now = Date.now();
        if (now - windowStart > RATE_LIMIT_WINDOW) return false; // window expired
        return count >= RATE_LIMIT_MAX;
      }

      function recordSend() {
        const { count, windowStart } = getRateLimitData();
        const now = Date.now();
        if (now - windowStart > RATE_LIMIT_WINDOW) {
          localStorage.setItem(
            "vday_sends",
            JSON.stringify({ count: 1, windowStart: now }),
          );
        } else {
          localStorage.setItem(
            "vday_sends",
            JSON.stringify({ count: count + 1, windowStart }),
          );
        }
      }

      function showFeedback(type, message) {
        // Remove any existing feedback
        const existing = document.getElementById("feedbackBox");
        if (existing) existing.remove();

        const box = document.createElement("div");
        box.id = "feedbackBox";
        box.style.cssText = `
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    background: ${type === "success" ? "#d4edda" : "#f8d7da"};
    color: ${type === "success" ? "#155724" : "#721c24"};
    border: 1px solid ${type === "success" ? "#c3e6cb" : "#f5c6cb"};
  `;
        box.textContent = message;
        document.querySelector(".container").appendChild(box);
      }

      function validateForm(recipient, message) {
        if (!recipient) {
          showFeedback("error", "‚ö†Ô∏è Please select a recipient.");
          return false;
        }
        const trimmed = message.trim();
        if (trimmed.length < 10) {
          showFeedback(
            "error",
            "‚ö†Ô∏è Your message is too short. Write at least 10 characters.",
          );
          return false;
        }
        if (trimmed.length > 500) {
          showFeedback("error", "‚ö†Ô∏è Message exceeds 500 characters.");
          return false;
        }
        // Basic XSS pattern check
        const suspicious = /<[^>]*>|javascript:|on\w+\s*=/i;
        if (suspicious.test(trimmed)) {
          showFeedback("error", "‚ö†Ô∏è Message contains invalid characters.");
          return false;
        }
        return true;
      }

      // Form submission handler
      const form = document.getElementById("valentineForm");
      const loading = document.getElementById("loading");

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        const recipient = document.getElementById("recipient").value;
        const message = messageField.value;
        const submitBtn = form.querySelector('button[type="submit"]');

        // Check rate limit
        if (isRateLimited()) {
          showFeedback(
            "error",
            "‚è≥ You've sent too many notes! Please wait a while before sending more.",
          );
          return;
        }

        // Validate
        if (!validateForm(recipient, message)) return;

        // Show loading
        loading.classList.add("active");
        submitBtn.disabled = true;
        submitBtn.textContent = "Sending...";

        try {
          const response = await fetch(form.action, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-Valentine-Token": AUTH_TOKEN,
            },
            body: JSON.stringify({ recipient, message: message.trim() }),
          });

          if (response.ok) {
            recordSend();
            form.reset();
            charCount.textContent = "0";
            showFeedback(
              "success",
              "üíñ Your note has been sent anonymously! Have a lovely Valentine's Day!",
            );
          } else {
            showFeedback("error", "‚ùå Something went wrong. Please try again.");
          }
        } catch (err) {
          showFeedback(
            "error",
            "‚ùå Could not reach the server. Check your connection.",
          );
        } finally {
          loading.classList.remove("active");
          submitBtn.disabled = false;
          submitBtn.textContent = "Send üíñ";
        }
      });
    </script>
  </body>
</html>
